# Домашнее задание к занятию «Компоненты Kubernetes»

### Цель задания

Рассчитать требования к кластеру под проект

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания:

- [Considerations for large clusters](https://kubernetes.io/docs/setup/best-practices/cluster-large/),
- [Architecting Kubernetes clusters — choosing a worker node size](https://learnk8s.io/kubernetes-node-size).

------

### Задание.  Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

----

### Правила приёма работы

1. Домашняя работа оформляется в своем Git-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Сначала сделайте расчёт всех необходимых ресурсов.
3. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
4. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды. 
5. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные. 
6. В результате должно быть указано количество нод и их параметры.

### Ответ
Master Nodes:
--------------------------------------------------------------------------------------------------------------------
Для Master Nodes вместе ОС  потребуются следующие ресурсы: 
|CPU     | RAM    |
|:------:|:------:|
|2 ядра |  4 ГБ |

Etcd можно разместить на master node.  Соответсвенно для достижения отказоустойчивости нам необходимо 3 master node (рекомендуется нечётное количество экземпляров  т.к. etcd используетRAFT-алгоритм).  

СPU: 2 × 3 = 6 ядер

RAM: 4 × 3 = 12 ГБ

Для обеспечения стабильности при обработки пиковых нагрузок добавим 20-30% дополнительных ресуросов

СPU: 6 × 0.2 + 6 = 7.2 ≈ 8 ядер

RAM: 12 × 0.2 + 12 = 14.4 ≈ 15 ГБ

Worker Nodes:
-------------------------------------------------------------------------------------------------------------
Подсчитываем колличество необходимых ресуросов без запаса

|      |   База данных (3 копии)|  Кеш (3 копии) |Фронтенд (5 копий)  | Бекенд (10 копий)| Итого  |
|:----:|:----------------------:|:--------------:|:------------------:|:----------------:|:------:|
|CPU:  |       1 × 3 = 3 ядра   | 1 × 3 = 3 ядра | 0.2 × 5 = 1 ядро   | 1 × 10 = 10 ядер |17 ядер |
|RAM:  |       4 × 3 = 12 ГБ    | 4 × 3 = 12 ГБ  | 0,05 × 5 = 0.25 ГБ | 0.6 × 10 =  6 ГБ |30.25 ГБ| 

Для обеспечения стабильности при обработки пиковых нагрузок добавим 20-30%  дополнительных ресуросов

17 ядер × 0.3 + 17 ядер = 22,1 ≈ 23 ядра

30.25 ГБ × 0.3 + 30.25 ГБ = 39.325 ≈ 40 ГБ

Определям колличество рабочих нод, которые справятся с данной нагрузкой 

Общие ресурсы трубуемые для приложения

|CPU     | RAM    |
|:------:|:------:|
|23 ядра |  40 ГБ |

Возьмем  типичные характеристики для среднестатистической ноды
|CPU     | RAM    |
|:------:|:------:|
|4 ядра |  16 ГБ |

Так же необходимо выделить на каждой ноде часть ресурсов под систмные процессы. Возьмем за основу следующие цифры

|CPU     | RAM    |
|:------:|:------:|
|1 ядра |  1 ГБ |

Расчитаем доступные ресурсы на одной ноде

CPU: 4 ядра - 1 ядро = 3 ядра

RAM: 16 ГБ - 1 ГБ = 15 ГБ

Расчитываем колличество нод

23 ядра ÷ 3 ядра = 7.66666666667 ≈ 8 нод

40 ГБ ÷ 15 ГБ = 2.66666666667 ≈ 3 ноды

Выбираем максимально значение  из расчетов по RAM и CPU. У нас получилось 8 нод. 
